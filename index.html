<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quota Dashboard</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;background:#0b1220;color:#e5e7eb;margin:24px}
    h1{margin:0 0 8px}
    .muted{color:#94a3b8}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:16px}
    .card{background:#121a2b;border:1px solid #25324a;border-radius:12px;padding:14px}
    .ok{color:#22c55e}.warn{color:#f59e0b}.err{color:#ef4444}
    code{background:#1f2937;padding:2px 6px;border-radius:6px}
    button{background:#2563eb;color:white;border:none;border-radius:8px;padding:8px 12px;cursor:pointer}
  </style>
</head>
<body>
  <h1>OpenClaw Quota Dashboard</h1>
  <p class="muted">Data source: <code>quota-status.json</code> | <span id="ts">loading...</span></p>
  <button id="refresh">Refresh</button>
  <div id="cards" class="grid"></div>

  <script>
    function badgeClass(status){
      if(status===ok) return ok;
      if(status===configured || status===configured_but_not_ok) return warn;
      return err;
    }

    function fmt(v){ return v===null || v===undefined ? - : String(v); }

    async function load(){
      const res = await fetch(`quota-status.json?ts=${Date.now()}`);
      const data = await res.json();
      document.getElementById(ts).textContent = `Updated: ${data.timestamp_utc}`;
      const providers = data.providers || {};
      const cards = Object.entries(providers).map(([name, p]) => {
        const cls = badgeClass(p.status);
        return `<div class="card">
          <h3>${name}</h3>
          <p>Status: <b class="${cls}">${fmt(p.status)}</b></p>
          <p>HTTP: ${fmt(p.http)}</p>
          <p>Message: ${fmt(p.message)}</p>
          <p>Remaining: ${fmt(p.remaining)}</p>
          <p>Daily USD: ${fmt(p.usage_daily_usd)}</p>
        </div>`;
      }).join();
      document.getElementById(cards).innerHTML = cards;
    }

    document.getElementById(refresh).addEventListener(click, load);
    load();
  </script>
</body>
</html>
